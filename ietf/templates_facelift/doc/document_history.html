{% extends "base.html" %}

{% load ietf_filters %}

{% block title %}History for {{ doc.name }}-{{ doc.rev }}{% endblock %}

{% block pagehead %}
	<link rel="alternate" type="application/atom+xml" href="/feed/document-changes/{{ doc.canonical_name }}/" />
{% endblock %}

{% block content %}
{{ top|safe }}

{% if diff_revisions and diff_revisions|length > 1 %}
	<h2>Revision differences</h2>

	<form class="form-horizontal"  role="form" action="http{% if request.is_secure %}s{% endif %}:{{rfcdiff_prefix}}" method="get" target="_blank">

		<div class="form-group">
			<div class="col-sm-2 ">
				<label for="url1" class="control-label">From revision</label>
			</div>
			<div class="col-sm-10">
				<select class="form-control" id="url1">
					{% for name, rev, time, url in diff_revisions %}
						<option value="{{ url }}" {% if forloop.counter == 2 %} selected="selected" {% endif %}>
							{{ name }}{% if rev %}-{{ rev }}{% endif %}
							({{ time|date:"Y-m-d" }})
						</option>
					{% endfor %}
				</select>
			</div>
		</div>

		<div class="form-group">
			<div class="col-sm-2 ">
				<label for="url2" class="control-label">To revision</label>
			</div>
			<div class="col-sm-10">
				<select class="form-control" id="url2">
					{% for name, rev, time, url in diff_revisions %}
						<option value="{{ url }}" {% if forloop.counter == 1 %} selected="selected" {% endif %}>
							{{ name }}{% if rev %}-{{ rev }}{% endif %}
							({{ time|date:"Y-m-d" }})
						</option>
					{% endfor %}
				</select>
			</div>
		</div>

		<div class="form-group">
			<div class="col-sm-2 ">
				<label class="control-label">Diff format</label>
			</div>
			<div class="col-sm-10">
				<div class="btn-group" data-toggle="buttons">
					<label class="btn btn-default active">
						<input type="radio" name="difftype" value="--html"> Side-by-side
					</label>
					<label class="btn btn-default">
						<input type="radio" name="difftype" value="--abdiff"> Before-after
					</label>
					<label class="btn btn-default">
						<input type="radio" name="difftype" value="--chbars"> Change bars
					</label>
					<label class="btn btn-default">
						<input type="radio" name="difftype" value="--hwdiff"> Wdiff
					</label>
				</div>
			</div>
		</div>

		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<button type="submit" class="btn btn-primary">Submit</button>
			</div>
		</div>

	</form>
{% endif %}

<h2>Document history</h2>
{% if user|has_role:"Area Director,Secretariat,IANA,RFC Editor" %}
	<p><a class="btn btn-primary" href="{% url "doc_add_comment" name=doc.name %}">Add comment</a></p>
{% endif %}

<table class="table table-condensed table-striped">
	<tr>
		<th>Date</th>
		<th>Version</th>
		<th>By</th>
		<th>Text</th>
	</tr>

	{% for e in events %}
		<tr class="{% cycle oddrow,evenrow %}" id="history-{{ e.pk }}">
			<td class="nowrap">{{ e.time|date:"Y-m-d" }}</td>
			<td class="text-center">{{ e.rev }}</td>
			<td>{{ e.by|escape }}</td>
			<td>{{ e.desc|format_history_text_facelift }}
			</td>
		</tr>
	{% endfor %}
</table>
{% endblock content %}
